# Keycloak configuration for OpenShift (OKD)
# Deploy with: helm install keycloak oci://registry-1.docker.io/bitnamicharts/keycloak -f values.okd.yaml -n thongdhse160015-dev
# After deployment, create HTTPS route: oc create route edge keycloak --service=keycloak --port=http --insecure-policy=Redirect -n thongdhse160015-dev

# Global OpenShift compatibility settings
global:
  compatibility:
    openshift:
      adaptSecurityContext: auto  # Auto-adapt security context for OpenShift

# Override image repositories (bitnami -> bitnamilegacy)
image:
  repository: bitnamilegacy/keycloak

keycloakConfigCli:
  image:
    repository: bitnamilegacy/keycloak-config-cli

# Proxy headers for OpenShift Router
proxyHeaders: "xforwarded"

# Disable Ingress (use OpenShift Route instead)
ingress:
  enabled: false

# TLS configuration
tls:
  enabled: false
  autoGenerated:
    enabled: false

# Environment variables
extraEnvVars:
  - name: KC_HOSTNAME
    value: "keycloak-thongdhse160015-dev.apps.rm3.7wse.p1.openshiftapps.com"  # OpenShift route hostname
  - name: KC_PROXY
    value: "edge"  # OpenShift edge termination (HTTPS at route, HTTP to pod)

# Service configuration
service:
  type: ClusterIP
  ports:
    http: 8080

# Resource limits (adjust based on your quota)
resources:
  limits:
    cpu: 1000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 1Gi

# PostgreSQL configuration
postgresql:
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
  primary:
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
