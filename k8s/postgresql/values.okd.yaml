# PostgreSQL standalone deployment for OKD
# Deploy with: helm install postgresql oci://registry-1.docker.io/bitnamicharts/postgresql -f values.okd.yaml -n thongdhse160015-dev

# Global OpenShift compatibility settings
global:
  compatibility:
    openshift:
      adaptSecurityContext: auto

# Override image repository
image:
  registry: docker.io
  repository: bitnamilegacy/postgresql
  tag: "17.6.0-debian-12-r0"

# Authentication
auth:
  username: bn_keycloak
  password: "keycloak123"  # Change this to a secure password
  postgresPassword: "postgres123"  # Change this to a secure password
  database: bitnami_keycloak

# Primary PostgreSQL configuration
primary:
  # Resource limits (adjust based on your quota)
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  
  # Persistence
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""  # Use default storage class
  
  # PostgreSQL configuration
  extendedConfiguration: |
    max_connections = 200
    shared_buffers = 128MB
    effective_cache_size = 256MB
    maintenance_work_mem = 64MB
    checkpoint_completion_target = 0.9
    wal_buffers = 4MB
    default_statistics_target = 100
    random_page_cost = 1.1
    effective_io_concurrency = 200
    work_mem = 655kB
    min_wal_size = 1GB
    max_wal_size = 4GB

# Service configuration
service:
  type: ClusterIP
  ports:
    postgresql: 5432

# Metrics (optional)
metrics:
  enabled: false
